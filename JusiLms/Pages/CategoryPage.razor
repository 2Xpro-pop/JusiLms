@page "/category/{Id:guid}"

@inject ICategoryService CategoryService
@inject ILessonsApi LessonsService
@inject NavigationManager NavigationManager

@if (_category == null && !_notFound)
{
    <MudProgressCircular Color="Color.Secondary" Indeterminate="true" />
    return;
}

@if (_notFound)
{
    <MudText Typo="Typo.h2">Not found :^(</MudText>
    return;
}

<MudText Typo="Typo.h3" Class="mt-4">@_category!.Name</MudText>
<MudDivider Light=true Class="mb-4" />

<div class="row justify-content-evenly align-self-stretch">
    @foreach (var lesson in _lessons)
    {
        <div class="col-12 col-sm-6 col-md-4 col-lg-3 p-3 ">
            <div class="dark-card w-100 dark-card-container text-white avante mud-ripple" @onclick=@(_ => NavigationManager.NavigateTo($"lesson/{lesson.Id}"))>
                <MudText Typo="Typo.h6" GutterBottom=true>@lesson.Header</MudText>
                <MudText>@lesson.Description</MudText>
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public Guid Id { get; set; }

    private bool _notFound;
    private Category? _category;

    private IEnumerable<Lesson> _lessons = Array.Empty<Lesson>();

    protected override async Task OnInitializedAsync()
    {
        _category = await CategoryService.GetCategory(Id);
        _notFound = _category == null;

        if (_category == null)
        {
            return;
        }

        try
        {
            _lessons = await LessonsService.GetLessonsByCategory(_category.Id);
        }
        catch
        {
            _lessons = Array.Empty<Lesson>();
        }
    }
}
